# Production configuration
# Usage:
#   Production: docker compose -f docker-compose.yml up -d
#   Development: docker compose up -d (automatically merges with docker-compose.override.yml)

services:
  2048-game: # Service name
    build: . # Look for a Dockerfile in the current directory
    ports:
      - "2048:80"
    restart: unless-stopped # Always restart the container unless it is explicitly stopped
    read_only: true # Make the container filesystem read-only for better security
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost/ || exit 1"]
      interval: 1m30s
      timeout: 10s
      retries: 3
      start_period: 10s
    tmpfs:
      # Provide writable tmpfs mounts for nginx runtime dirs when using read_only: true
      - /var/cache/nginx:uid=101,gid=101
      - /var/run/nginx:uid=101,gid=101
      - /tmp:uid=101,gid=101